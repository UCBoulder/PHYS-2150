<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EQE Measurement - PHYS 2150</title>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/eqe-layout.css">

    <!-- Plotly.js for interactive plots (local copy) -->
    <script src="js/plotly.min.js"></script>

    <!-- Qt WebChannel -->
    <script src="qrc:///qtwebchannel/qwebchannel.js"></script>

    <!-- Shared modules -->
    <script src="js/api.js"></script>
    <script src="js/config.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/modals.js"></script>
</head>
<body class="dark-mode eqe-body">
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <main id="main-content" class="eqe-app">
        <h1 class="visually-hidden">EQE Measurement Application</h1>
        <!-- Tab Navigation with Header Actions -->
        <div class="tab-bar" role="tablist" aria-label="Application views">
            <button class="tab-btn active" role="tab" id="tab-measurement-btn" aria-selected="true" aria-controls="tab-measurement" onclick="switchTab('measurement')">Measurement</button>
            <button class="tab-btn" role="tab" id="tab-stability-btn" aria-selected="false" aria-controls="tab-stability" onclick="switchTab('stability')">Stability Test</button>
            <button class="tab-btn" role="tab" id="tab-lockinlab-btn" aria-selected="false" aria-controls="tab-lockinlab" onclick="switchTab('lockinlab')">Lock-in Lab</button>
            <button class="tab-btn staff-tab" role="tab" id="analysis-tab-btn" aria-selected="false" aria-controls="tab-analysis" onclick="switchTab('analysis')" style="display: none;">
                EQE Analysis
                <span class="staff-badge-small">STAFF</span>
            </button>
            <div class="tab-bar-spacer"></div>
            <span id="pixel-label" class="text-muted">Pixel: --</span>
            <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme" aria-label="Toggle light/dark theme">
                <svg id="sun-icon" class="theme-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <circle cx="12" cy="12" r="5"/>
                    <line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                    <line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                </svg>
                <svg id="moon-icon" class="theme-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                </svg>
            </button>
        </div>

        <!-- Hidden file inputs for EQE Analysis -->
        <input type="file" id="power-file-input" accept=".csv" style="display: none;" onchange="onPowerFileSelected(event)">
        <input type="file" id="current-file-input" accept=".csv" style="display: none;" onchange="onCurrentFileSelected(event)">

        <!-- Device Status Row with Monochromator Controls (shared across tabs) -->
        <div class="device-status-row">
            <span class="row-section-title">Device Status</span>
            <div class="device-item">
                <span class="device-dot disconnected" id="picoscope-dot" aria-hidden="true"></span>
                <span class="device-name">PicoScope:</span>
                <span class="device-status" id="picoscope-status" aria-live="polite">Connecting...</span>
            </div>
            <div class="device-item">
                <span class="device-dot disconnected" id="mono-dot" aria-hidden="true"></span>
                <span class="device-name">Monochromator:</span>
                <span class="device-status" id="mono-status" aria-live="polite">Connecting...</span>
            </div>
            <div class="device-item">
                <span class="device-dot disconnected" id="power-dot" aria-hidden="true"></span>
                <span class="device-name">Power Meter:</span>
                <span class="device-status" id="power-status" aria-live="polite">Connecting...</span>
            </div>

            <div class="mono-controls-inline">
                <span class="row-section-title">Monochromator</span>
                <span class="mono-state"><span id="mono-wavelength">--</span> nm</span>
                <span class="shutter-badge closed" id="shutter-badge">Closed</span>
                <input type="number" id="wavelength-input" placeholder="nm" min="200" max="1200" aria-label="Target wavelength in nanometers">
                <button class="btn btn-secondary btn-small" onclick="goToWavelength()">Go</button>
                <button class="btn btn-secondary btn-small" id="shutter-btn" onclick="toggleShutter()">Open</button>
                <button class="btn btn-secondary btn-small" onclick="alignMonochromator()">Align</button>
            </div>
        </div>

        <!-- ==================== MEASUREMENT TAB ==================== -->
        <div id="tab-measurement" class="tab-content active" role="tabpanel" aria-labelledby="tab-measurement-btn">

        <!-- Top Section: Parameters + Progress -->
        <div class="top-section">
            <div class="params-panel">
                <div class="panel-title">Measurement Parameters</div>
                <div class="params-grid">
                    <div class="param-field">
                        <label for="start-wavelength">Start (nm)</label>
                        <input type="number" id="start-wavelength" step="10" aria-label="Start wavelength in nanometers">
                    </div>
                    <div class="param-field">
                        <label for="end-wavelength">End (nm)</label>
                        <input type="number" id="end-wavelength" step="10" aria-label="End wavelength in nanometers">
                    </div>
                    <div class="param-field">
                        <label for="step-size">Step (nm)</label>
                        <input type="number" id="step-size" step="1" aria-label="Step size in nanometers">
                    </div>
                    <div class="param-field">
                        <label for="cell-number">Cell Number</label>
                        <input type="text" id="cell-number" placeholder="e.g. 140" maxlength="3" aria-label="Cell number, 3 digits">
                    </div>
                </div>
            </div>

            <div class="progress-panel">
                <div class="panel-title">Status</div>
                <div class="progress-content">
                    <div class="progress-status" id="progress-status" role="status" aria-live="polite">Ready</div>
                    <div class="progress-bar-container" id="progress-bar-row">
                        <div class="progress-bar">
                            <div class="progress-bar-fill" id="progress-fill" style="width: 0%"></div>
                        </div>
                        <span class="progress-percent" id="progress-percent">0%</span>
                    </div>
                    <div class="live-reading hidden" id="live-reading">
                        <span id="live-value">--</span> nA
                    </div>
                </div>
            </div>
        </div>

        <!-- Two Plots Row -->
        <div class="plots-row plots-row-two">
            <div class="plot-panel">
                <div class="plot-title">Incident Light Power</div>
                <div class="plot-container">
                    <div id="power-plot" class="plot"></div>
                </div>
            </div>

            <div class="plot-panel">
                <div class="plot-title">PV Current</div>
                <div class="plot-container">
                    <div id="current-plot" class="plot"></div>
                </div>
                <div class="stats-row hidden" id="stats-row">
                    <span class="stat-item">n: <span class="stat-value" id="stats-n">--</span></span>
                    <span class="stat-item">SD: <span class="stat-value" id="stats-sd">--</span></span>
                    <span class="stat-item">SE: <span class="stat-value" id="stats-se">--</span></span>
                    <span class="stat-item">CV: <span class="stat-value" id="stats-cv">--%</span></span>
                    <span class="quality-badge" id="stats-quality">--</span>
                </div>
            </div>
        </div>

        <!-- Buttons Row -->
        <div class="buttons-row">
            <button class="btn btn-primary" id="power-btn" onclick="startPowerMeasurement()">
                Start Power Measurement
            </button>
            <button class="btn btn-primary" id="current-btn" onclick="startCurrentMeasurement()">
                Start Current Measurement
            </button>
            <button class="btn btn-danger" id="stop-btn" onclick="stopMeasurement()" disabled>
                Stop
            </button>
            <button class="btn btn-secondary" id="save-btn" onclick="saveData()" disabled>
                Save Data
            </button>
            <button class="btn btn-secondary" id="live-btn" onclick="toggleLiveMonitor()">
                Live Monitor
            </button>
        </div>

        </div><!-- End Measurement Tab -->

        <!-- ==================== STABILITY TEST TAB ==================== -->
        <div id="tab-stability" class="tab-content" role="tabpanel" aria-labelledby="tab-stability-btn">

        <!-- Configuration Row -->
        <div class="stability-config">
            <div class="stability-config-panel">
                <div class="config-header">
                    <div class="panel-title">Test Configuration</div>
                    <div class="test-type-selector">
                        <label>Test Type:</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="stability-type" value="power" checked onchange="onStabilityTypeChange()">
                                <span>Power</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="stability-type" value="current" onchange="onStabilityTypeChange()">
                                <span>Current</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="params-grid" style="grid-template-columns: repeat(3, 1fr);">
                    <div class="param-field">
                        <label for="stability-wavelength">Wavelength (nm)</label>
                        <input type="number" id="stability-wavelength" step="10" aria-label="Test wavelength in nanometers">
                    </div>
                    <div class="param-field">
                        <label for="stability-duration">Duration (min)</label>
                        <input type="number" id="stability-duration" aria-label="Test duration in minutes">
                    </div>
                    <div class="param-field">
                        <label for="stability-interval">Interval (sec)</label>
                        <input type="number" id="stability-interval" aria-label="Measurement interval in seconds">
                    </div>
                </div>
            </div>

            <div class="progress-panel">
                <div class="panel-title">Status</div>
                <div class="progress-content">
                    <div class="progress-status" id="stability-status" role="status" aria-live="polite">Ready</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar">
                            <div class="progress-bar-fill" id="stability-progress-fill" style="width: 0%"></div>
                        </div>
                        <span class="progress-percent" id="stability-progress-percent">0%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dual Plots Row -->
        <div class="stability-plots">
            <div class="plot-panel">
                <div class="plot-title">Time Series</div>
                <div class="plot-container">
                    <div id="stability-time-plot" class="plot"></div>
                </div>
            </div>
            <div class="plot-panel">
                <div class="plot-title">Histogram</div>
                <div class="plot-container">
                    <div id="stability-hist-plot" class="plot"></div>
                </div>
            </div>
        </div>

        <!-- Statistics Bar -->
        <div class="stability-stats-bar">
            <span class="row-section-title">Cumulative Statistics</span>
            <div class="stability-stat">
                <span class="stability-stat-label">Mean:</span>
                <span class="stability-stat-value" id="stability-mean">--</span>
            </div>
            <div class="stability-stat">
                <span class="stability-stat-label">Std Dev:</span>
                <span class="stability-stat-value" id="stability-std">--</span>
            </div>
            <div class="stability-stat">
                <span class="stability-stat-label">CV:</span>
                <span class="stability-stat-value cv" id="stability-cv">--%</span>
            </div>
            <div class="stability-stat">
                <span class="stability-stat-label">Count:</span>
                <span class="stability-stat-value" id="stability-count">0</span>
            </div>
            <div class="stability-stat">
                <span class="stability-stat-label">Range:</span>
                <span class="stability-stat-value" id="stability-range">--</span>
            </div>
        </div>

        <!-- Buttons Row -->
        <div class="buttons-row">
            <button class="btn btn-primary" id="stability-start-btn" onclick="startStabilityTest()">
                Start Test
            </button>
            <button class="btn btn-danger" id="stability-stop-btn" onclick="stopStabilityTest()" disabled>
                Stop Test
            </button>
            <button class="btn btn-secondary" id="stability-save-btn" onclick="saveStabilityData()" disabled>
                Save Results
            </button>
        </div>

        </div><!-- End Stability Tab -->

        <!-- ==================== LOCK-IN LAB TAB ==================== -->
        <div id="tab-lockinlab" class="tab-content" role="tabpanel" aria-labelledby="tab-lockinlab-btn">

        <!-- Main Layout: Sidebar | Plot Area -->
        <div class="lockinlab-main">
            <!-- Left Sidebar: Controls + Steps -->
            <div class="lockinlab-sidebar">
                <!-- Capture Button -->
                <div class="lockinlab-capture-section">
                    <button class="btn btn-primary" id="lockinlab-capture-btn" onclick="captureLockinData()">
                        Capture New Data
                    </button>
                </div>

                <!-- Processing Steps -->
                <div class="params-panel lockinlab-steps-panel">
                    <div class="panel-title">Processing Steps</div>
                    <div class="lockinlab-steps">
                        <label class="toggle-switch">
                            <input type="checkbox" id="step-raw" checked onchange="onLockinStepChange()">
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">Step 1: Show raw signals</span>
                        </label>

                        <label class="toggle-switch">
                            <input type="checkbox" id="step-removedc" onchange="onLockinStepChange()">
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">Step 2: Subtract mean</span>
                        </label>

                        <label class="toggle-switch">
                            <input type="checkbox" id="step-multiply" onchange="onLockinStepChange()">
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">Step 3: Multiply signal × reference</span>
                        </label>

                        <label class="toggle-switch">
                            <input type="checkbox" id="step-average" onchange="onLockinStepChange()">
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">Step 4: Average over time</span>
                        </label>
                    </div>

                    <div class="lockinlab-result">
                        <span class="result-label">Expected:</span>
                        <span class="result-value" id="lockinlab-expected">-- mV</span>
                    </div>
                    <div class="lockinlab-result extracted">
                        <span class="result-label">Extracted:</span>
                        <span class="result-value" id="lockinlab-result">-- mV</span>
                    </div>
                </div>

                <!-- Signal Parameters -->
                <div class="params-panel lockinlab-params-panel">
                    <div class="panel-title">Signal Parameters</div>
                    <div class="lockinlab-controls">
                        <div class="param-field">
                            <label for="lockinlab-amplitude">Pk-Pk Modulation <span class="slider-value" id="lockinlab-amplitude-value">150 mV</span></label>
                            <input type="range" id="lockinlab-amplitude" min="10" max="500" value="150" oninput="onLockinSignalParamChange()">
                        </div>

                        <div class="param-field">
                            <label for="lockinlab-dcoffset">DC Offset <span class="slider-value" id="lockinlab-dcoffset-value">100 mV</span></label>
                            <input type="range" id="lockinlab-dcoffset" min="0" max="300" value="100" oninput="onLockinSignalParamChange()">
                        </div>

                        <div class="param-field">
                            <label for="lockinlab-noise">Noise Level <span class="slider-value" id="lockinlab-noise-value">30%</span></label>
                            <input type="range" id="lockinlab-noise" min="0" max="100" value="30" oninput="onLockinParamChange()">
                        </div>

                        <div class="param-field">
                            <label for="lockinlab-phase">Reference Phase <span class="slider-value" id="lockinlab-phase-value">0°</span></label>
                            <input type="range" id="lockinlab-phase" min="-180" max="180" value="0" oninput="onLockinParamChange()">
                        </div>

                        <div class="param-field">
                            <label for="lockinlab-cycles">Integration Cycles <span class="slider-value" id="lockinlab-cycles-value">10</span></label>
                            <input type="range" id="lockinlab-cycles" min="1" max="50" value="10" oninput="onLockinParamChange()">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right: Explanation + Plot -->
            <div class="lockinlab-content">
                <!-- Explanation Panel (compact) -->
                <div class="params-panel lockinlab-explanation">
                    <div class="explanation-header">
                        <div class="panel-title">What's Happening</div>
                        <label class="toggle-switch data-source-toggle">
                            <input type="checkbox" id="lockinlab-simulated" onchange="onLockinDataSourceChange()">
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">Simulated Data</span>
                        </label>
                    </div>
                    <div class="explanation-content" id="lockinlab-explanation-text">
                        <p>Click <strong>Capture New Data</strong> to start, then enable each processing step to see how <strong>phase-sensitive detection</strong> (PSD) extracts your signal from noise.</p>
                        <p>This is the technique used in lock-in amplifiers: multiply by a reference, then average.</p>
                    </div>
                </div>

                <!-- Plot Area -->
                <div class="plot-panel lockinlab-waveform-panel">
                    <div class="plot-title">Phase-Sensitive Detection Visualization</div>
                    <div class="plot-container waveform-container">
                        <div id="lockinlab-plot" class="plot"></div>
                    </div>
                    <div class="waveform-legend" id="lockinlab-legend">
                        <span class="legend-item signal">Signal</span>
                        <span class="legend-item reference">Reference (81 Hz)</span>
                    </div>
                </div>
            </div>
        </div>

        </div><!-- End Lock-in Lab Tab -->

        <!-- EQE Analysis Tab (Staff Mode - Ctrl+Shift+E) -->
        <div id="tab-analysis" class="tab-content" role="tabpanel" aria-labelledby="analysis-tab-btn">
            <!-- Top Section: Data Source + Status -->
            <div class="top-section">
                <div class="params-panel analysis-source-panel">
                    <div class="panel-title">Data Source</div>
                    <div class="analysis-source-layout">
                        <div class="analysis-data-grid">
                            <span class="analysis-data-label">Power:</span>
                            <button class="btn btn-secondary btn-xs" id="use-power-session-btn" onclick="usePowerSession()" disabled>Session</button>
                            <button class="btn btn-secondary btn-xs" onclick="loadPowerCSV()">Load File</button>
                            <span class="analysis-file-status" id="power-file-status">No data</span>

                            <span class="analysis-data-label">Current:</span>
                            <button class="btn btn-secondary btn-xs" id="use-current-session-btn" onclick="useCurrentSession()" disabled>Session</button>
                            <button class="btn btn-secondary btn-xs" onclick="loadCurrentCSV()">Load File</button>
                            <span class="analysis-file-status" id="current-file-status">No data</span>
                        </div>
                        <button class="btn btn-primary" id="calculate-eqe-btn" onclick="calculateEQE()" disabled>
                            Calculate EQE
                        </button>
                    </div>
                </div>

                <div class="progress-panel">
                    <div class="panel-title">Status</div>
                    <div class="progress-content">
                        <div class="progress-status analysis-status-text" id="analysis-status" role="status" aria-live="polite">Ready - load power and current data to calculate EQE</div>
                    </div>
                </div>
            </div>

            <!-- Plot Row: EQE Spectrum + Results -->
            <div class="analysis-plots-row">
                <div class="plot-panel analysis-eqe-panel">
                    <div class="plot-title">EQE Spectrum</div>
                    <div class="plot-container">
                        <div id="eqe-plot" class="plot"></div>
                    </div>
                </div>

                <div class="params-panel analysis-results-panel">
                    <div class="panel-title">Results</div>
                    <div class="analysis-metrics">
                        <div class="analysis-metric">
                            <span class="analysis-metric-label">Peak EQE</span>
                            <span class="analysis-metric-value peak" id="metric-peak-eqe">--%</span>
                            <span class="analysis-metric-detail" id="metric-peak-wavelength">at -- nm</span>
                        </div>
                        <div class="analysis-metric">
                            <span class="analysis-metric-label">Bandgap Edge</span>
                            <span class="analysis-metric-value" id="metric-bandgap">-- nm</span>
                            <span class="analysis-metric-detail" id="metric-bandgap-ev">(-- eV)</span>
                        </div>
                        <div class="analysis-metric">
                            <span class="analysis-metric-label">Integrated J<sub>sc</sub></span>
                            <span class="analysis-metric-value" id="metric-jsc">-- mA/cm²</span>
                            <span class="analysis-metric-detail" id="metric-jsc-note">AM1.5G spectrum</span>
                        </div>
                        <div class="analysis-metric">
                            <span class="analysis-metric-label">Data Points</span>
                            <span class="analysis-metric-value" id="metric-datapoints">--</span>
                        </div>
                    </div>
                    <button class="btn btn-secondary" id="btn-save-analysis" onclick="saveAnalysisResults()" disabled>Save Results</button>
                </div>
            </div>
        </div><!-- End Analysis Tab -->

    </main>

    <!-- Cell Number Modal (shown on startup) -->
    <div class="modal-overlay" id="cell-modal">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="cell-modal-title">
            <h2 class="modal-title" id="cell-modal-title">Enter Cell Number</h2>
            <div class="modal-body">
                <div class="input-group mb-0">
                    <label for="cell-input">Cell Number (e.g., 195)</label>
                    <input type="text" id="cell-input" pattern="[0-9]{3}" maxlength="3" placeholder="000" aria-describedby="cell-input-error">
                    <span class="input-error" id="cell-input-error" role="alert">Please enter a 3-digit cell number</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeCellModal()">Cancel</button>
                <button class="btn btn-primary" onclick="confirmCellNumber()">Continue</button>
            </div>
        </div>
    </div>

    <!-- Pixel Selection Modal -->
    <div class="modal-overlay" id="pixel-modal">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="pixel-modal-title">
            <h2 class="modal-title" id="pixel-modal-title">Select Pixel</h2>
            <div class="modal-body">
                <div class="input-group mb-0">
                    <label for="pixel-input">Pixel Number</label>
                    <input type="number" id="pixel-input">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closePixelModal()">Cancel</button>
                <button class="btn btn-primary" onclick="confirmPixel()">Start</button>
            </div>
        </div>
    </div>

    <!-- Save Data Modal -->
    <div class="modal-overlay" id="save-modal">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="save-modal-title">
            <h2 class="modal-title" id="save-modal-title">Save Data</h2>
            <div class="modal-body">
                <p style="margin-bottom: 16px; color: var(--text-secondary);">Which data would you like to save?</p>
                <div class="save-options">
                    <button class="btn btn-primary btn-block" id="save-power-btn" onclick="LabModals.confirmSavePower()" style="margin-bottom: 8px;">
                        Save Power Data
                    </button>
                    <button class="btn btn-primary btn-block" id="save-current-btn" onclick="LabModals.confirmSaveCurrent()">
                        Save Current Data
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="LabModals.closeSave()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Error Modal -->
    <div class="modal-overlay" id="error-modal">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="error-modal-title">
            <h2 class="modal-title" id="error-modal-title">Error</h2>
            <div class="modal-body">
                <p id="error-modal-message" style="color: var(--text-secondary); white-space: pre-wrap; text-align: left;"></p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="LabModals.closeError()">OK</button>
            </div>
        </div>
    </div>

    <!-- Info Modal -->
    <div class="modal-overlay" id="info-modal">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="info-modal-title">
            <h2 class="modal-title" id="info-modal-title">Info</h2>
            <div class="modal-body">
                <p id="info-modal-message" style="color: var(--text-secondary); white-space: pre-line;"></p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="LabModals.closeInfo()">OK</button>
            </div>
        </div>
    </div>

    <!-- Log Viewer Modal (Ctrl+Shift+L) -->
    <div class="modal-overlay" id="log-viewer-modal">
        <div class="modal log-viewer-modal" role="dialog" aria-modal="true" aria-labelledby="log-viewer-title">
            <h2 class="modal-title" id="log-viewer-title">
                Debug Logs
                <span class="modal-subtitle" id="log-viewer-path"></span>
            </h2>
            <div class="modal-body log-viewer-body">
                <pre class="log-viewer-content" id="log-viewer-content">Loading...</pre>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="LabModals.openLogFile()">Open Full Log</button>
                <button class="btn btn-secondary" id="log-copy-btn" onclick="LabModals.copyLogs()">Copy</button>
                <button class="btn btn-secondary" onclick="LabModals.refreshLogs()">Refresh</button>
                <button class="btn btn-primary" onclick="LabModals.closeLogViewer()">Close</button>
            </div>
        </div>
    </div>

    <!-- Console Panel -->
    <div class="console-panel" id="console-panel">
        <div class="console-resize-handle" id="console-resize-handle"></div>
        <div class="console-header">
            <div class="console-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <polyline points="4 17 10 11 4 5"></polyline>
                    <line x1="12" y1="19" x2="20" y2="19"></line>
                </svg>
                Console
            </div>
            <div class="console-actions">
                <button class="console-btn" onclick="copyConsole()">Copy</button>
                <button class="console-btn" onclick="clearConsole()">Clear</button>
                <button class="console-btn" onclick="toggleConsole()">Close</button>
            </div>
        </div>
        <div class="console-output" id="console-output">
            <div class="console-empty">No log messages yet. Run a measurement to see output.</div>
        </div>
    </div>

    <!-- Application module (ES6) -->
    <script type="module" src="js/eqe-app.js"></script>
</body>
</html>
